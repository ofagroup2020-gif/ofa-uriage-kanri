<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OFA æœˆæ¬¡å ±å‘Šãƒ•ã‚©ãƒ¼ãƒ ï¼ˆPDF/CSVï¼‰</title>

  <style>
    :root{
      --bg:#0b1220;
      --card:#111b2f;
      --line:rgba(255,255,255,.12);
      --text:#e9f1ff;
      --muted:rgba(233,241,255,.70);
      --accent:#ffd400;
      --ok:#19c37d;
      --bad:#ff5c5c;
      --shadow:0 12px 28px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
      background: radial-gradient(1200px 600px at 15% 10%, rgba(255,212,0,.18), transparent 60%),
                  radial-gradient(900px 500px at 85% 25%, rgba(25,195,125,.12), transparent 55%),
                  radial-gradient(900px 500px at 65% 95%, rgba(52,152,219,.16), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:18px 14px 120px}
    .topbar{
      position:sticky;top:0;z-index:50;
      display:flex;gap:12px;align-items:center;justify-content:space-between;
      padding:14px 10px;margin:-18px -14px 16px;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(11,18,32,.85), rgba(11,18,32,.35));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand{display:flex;gap:10px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, rgba(255,212,0,.95), rgba(255,120,0,.95));
      box-shadow:0 12px 20px rgba(255,212,0,.16);
      display:grid;place-items:center;font-weight:900;color:#111;letter-spacing:.04em;
    }
    .brand h1{font-size:16px;margin:0;line-height:1.15}
    .brand .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    button,.btn{
      border:0;cursor:pointer;
      padding:10px 12px;border-radius:12px;
      color:var(--text);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 18px rgba(0,0,0,.20);
      display:inline-flex;gap:8px;align-items:center;justify-content:center;
      font-weight:800;
    }
    button:hover,.btn:hover{filter:brightness(1.06)}
    .btn-accent{background:rgba(255,212,0,.16);border-color:rgba(255,212,0,.22)}
    .btn-ok{background:rgba(25,195,125,.14);border-color:rgba(25,195,125,.22)}
    .btn-bad{background:rgba(255,92,92,.14);border-color:rgba(255,92,92,.22)}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    h2{margin:0 0 10px;font-size:14px}
    .muted{color:var(--muted)}
    .row{display:grid;gap:10px}
    @media(min-width:720px){
      .row.cols2{grid-template-columns:1fr 1fr}
      .row.cols3{grid-template-columns:1fr 1fr 1fr}
      .row.cols4{grid-template-columns:1fr 1fr 1fr 1fr}
    }
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input,select,textarea{
      width:100%;
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      color:var(--text);
      padding:10px 12px;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:90px;resize:vertical}
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
    }
    th,td{padding:10px 10px;border-bottom:1px solid rgba(255,255,255,.08);font-size:12.5px}
    th{color:var(--muted);text-align:left;background:rgba(255,255,255,.04);font-weight:900}
    tr:last-child td{border-bottom:none}
    .right{text-align:right}
    .hr{height:1px;background:rgba(255,255,255,.10);margin:12px 0}
    .pill{
      padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);font-size:12px;color:var(--muted)
    }
    .good{color:var(--ok);font-weight:900}
    .bad{color:var(--bad);font-weight:900}

    /* å°åˆ·(PDF)ç”¨ */
    @media print{
      body{background:#fff;color:#000}
      .topbar,.no-print{display:none !important}
      .wrap{max-width:none;padding:0}
      .card{box-shadow:none;border:1px solid #ccc;background:#fff}
      table{border:1px solid #999;background:#fff}
      th{background:#f3f3f3;color:#111}
      td,th{border-bottom:1px solid #ddd;color:#111}
      .muted{color:#333}
      .pill{border:1px solid #ccc;background:#f7f7f7;color:#111}
      .good{color:#0a7d4f}
      .bad{color:#b80000}
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar no-print">
      <div class="brand">
        <div class="logo">OFA</div>
        <div>
          <h1>æœˆæ¬¡å ±å‘Šãƒ•ã‚©ãƒ¼ãƒ ï¼ˆPDF / CSVå‡ºåŠ›ï¼‰</h1>
          <div class="sub">æ‹ ç‚¹LPã‹ã‚‰é–‹ã â†’ å…¥åŠ› â†’ PDF/CSV â†’ LINEã§æœ¬éƒ¨ã¸è»¢é€</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn-accent" id="btnPDF">ğŸ–¨ï¸ PDFå‡ºåŠ›</button>
        <button class="btn" id="btnCSV">â¬‡ï¸ CSVå‡ºåŠ›</button>
        <button class="btn-ok" id="btnSave">ğŸ’¾ ç«¯æœ«ã«ä¿å­˜</button>
        <button class="btn-bad" id="btnClear">ğŸ§¹ å…¥åŠ›ã‚¯ãƒªã‚¢</button>
      </div>
    </div>

    <div class="card">
      <h2>â‘  åŸºæœ¬æƒ…å ±</h2>
      <div class="row cols4">
        <div>
          <label>å¯¾è±¡æœˆ</label>
          <input type="month" id="month">
        </div>
        <div>
          <label>å…¥åŠ›è€…åŒºåˆ†</label>
          <select id="role">
            <option value="ã‚¨ãƒªã‚¢ãƒãƒ">ã‚¨ãƒªã‚¢ãƒãƒï¼ˆç¾åœ°è²¬ä»»è€…ï¼‰</option>
            <option value="å–¶æ¥­ãƒãƒ³">å–¶æ¥­ãƒãƒ³ï¼ˆæœ¬éƒ¨/FCç®¡ç†ï¼‰</option>
            <option value="ãƒ•ãƒ©ãƒ³ãƒãƒ£ã‚¤ã‚º">ãƒ•ãƒ©ãƒ³ãƒãƒ£ã‚¤ã‚º</option>
          </select>
        </div>
        <div>
          <label>å…¥åŠ›è€…å</label>
          <input type="text" id="reporter" placeholder="ä¾‹ï¼šç”°ä¸­ / â—‹â—‹FCåº— ãªã©">
        </div>
        <div>
          <label>æ‹…å½“å–¶æ¥­ï¼ˆä»»æ„ï¼‰</label>
          <select id="salesOwner">
            <option value="">æœªæŒ‡å®š</option>
            <option value="æ£®ä¸‹">æ£®ä¸‹</option><option value="å¤ªç”°">å¤ªç”°</option><option value="æ¾å²¡">æ¾å²¡</option>
            <option value="å³¶ç”°">å³¶ç”°</option><option value="æ—¥é«˜">æ—¥é«˜</option><option value="å†…å±±">å†…å±±</option>
            <option value="æ—">æ—</option><option value="å±‹å®®">å±‹å®®</option>
          </select>
        </div>
      </div>

      <div class="row cols3" style="margin-top:10px">
        <div>
          <label>éƒ½é“åºœçœŒ</label>
          <select id="pref"></select>
        </div>
        <div>
          <label>æ‹ ç‚¹å / åº—èˆ—åï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="base" placeholder="ä¾‹ï¼šç¦å²¡å—æ‹ ç‚¹ / â—‹â—‹FCåº—">
        </div>
        <div>
          <label>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="memoShort" placeholder="ä¾‹ï¼šä»Šæœˆã¯å¢—å“¡ / å°æ•°å¢—">
        </div>
      </div>

      <div class="hr"></div>

      <h2>â‘¡ æœˆæ¬¡æ•°å€¤ï¼ˆå…¥åŠ›ã ã‘ï¼‰</h2>
      <div class="row cols3">
        <div>
          <label>å£²ä¸Šåˆè¨ˆï¼ˆå††ï¼‰</label>
          <input type="text" id="revenue" inputmode="numeric" placeholder="ä¾‹ï¼š2500000">
        </div>
        <div>
          <label>å§”è¨—ä¼šç¤¾è«‹æ±‚åˆè¨ˆï¼ˆå††ï¼‰</label>
          <input type="text" id="outsource" inputmode="numeric" placeholder="ä¾‹ï¼š1800000">
        </div>
        <div>
          <label>ãã®ä»–çµŒè²»ï¼ˆå††ï¼‰</label>
          <input type="text" id="otherCost" inputmode="numeric" placeholder="ä¾‹ï¼šé«˜é€Ÿ/å¤–æ³¨è¿½åŠ /ä¿®ç†ãªã©">
        </div>
      </div>

      <div class="row">
        <div>
          <label>å§”è¨—å†…è¨³ï¼ˆä»»æ„ãƒ»è‡ªç”±è¨˜å…¥ï¼‰</label>
          <textarea id="outsourceMemo" placeholder="ä¾‹ï¼šãƒ¤ãƒãƒˆ 1,200,000å†† / ä½å· 600,000å†† ãªã©"></textarea>
        </div>
      </div>

      <div class="hr"></div>

      <h2>â‘¢ è‡ªå‹•è¨ˆç®—ï¼ˆç¢ºèªç”¨ï¼‰</h2>
      <div class="row cols4">
        <div class="pill">ã‚³ã‚¹ãƒˆåˆè¨ˆï¼š<b id="costSum">0</b> å††</div>
        <div class="pill">åˆ©ç›Šï¼š<b id="profitSum">0</b> å††</div>
        <div class="pill">åˆ©ç›Šç‡ï¼š<b id="profitRate">0.0%</b></div>
        <div class="pill">å¤–æ³¨ç‡ï¼š<b id="outRate">0.0%</b></div>
      </div>

      <div class="hr"></div>

      <h2>â‘£ æ‰‹å½“ï¼ˆ0.3%ï¼‰</h2>
      <div class="row cols3">
        <div class="pill">ã‚¨ãƒªã‚¢ãƒãƒæ‰‹å½“ï¼ˆå£²ä¸ŠÃ—0.3%ï¼‰ï¼š<b id="allowMgr">0</b> å††</div>
        <div class="pill">å–¶æ¥­æ‰‹å½“ï¼ˆå£²ä¸ŠÃ—0.3%ï¼‰ï¼š<b id="allowSales">0</b> å††</div>
        <div class="pill">æ‰‹å½“åˆè¨ˆï¼š<b id="allowAll">0</b> å††</div>
      </div>

      <div class="hr"></div>

      <h2>â‘¤ é•·æ–‡ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</h2>
      <textarea id="memoLong" placeholder="ä¾‹ï¼šå‰å¹´å·®ã®è¦å› ã€å¢—å“¡/æ¸›å“¡ã€ã‚¯ãƒ¬ãƒ¼ãƒ ã€ç¨¼åƒç‡ã€æ¥æœˆã®è¦‹è¾¼ã¿ãªã©"></textarea>

      <div class="hr no-print"></div>

      <div class="muted no-print" style="font-size:12px;line-height:1.6">
        â€»æœ¬éƒ¨ã¸ã¯ã€ŒPDFä¿å­˜ã—ã¦LINEè»¢é€ã€ã¾ãŸã¯ã€ŒCSVã‚’LINEè»¢é€ã€ã—ã¦ãã ã•ã„ã€‚<br>
        â€»ã€Œç«¯æœ«ã«ä¿å­˜ã€ã¯ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨é€”ï¼‰ã€‚
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>å°åˆ·ã‚µãƒãƒªãƒ¼ï¼ˆãã®ã¾ã¾PDFã§æå‡ºï¼‰</h2>
      <table>
        <tbody>
          <tr><th style="width:200px">å¯¾è±¡æœˆ</th><td id="pMonth">â€”</td></tr>
          <tr><th>å…¥åŠ›è€…åŒºåˆ† / å</th><td id="pWho">â€”</td></tr>
          <tr><th>æ‹…å½“å–¶æ¥­</th><td id="pSales">â€”</td></tr>
          <tr><th>éƒ½é“åºœçœŒ / æ‹ ç‚¹</th><td id="pArea">â€”</td></tr>
          <tr><th>å£²ä¸Š / ã‚³ã‚¹ãƒˆ / åˆ©ç›Š</th><td id="pMoney">â€”</td></tr>
          <tr><th>åˆ©ç›Šç‡ / å¤–æ³¨ç‡</th><td id="pRates">â€”</td></tr>
          <tr><th>æ‰‹å½“ï¼ˆã‚¨ãƒªã‚¢ãƒãƒ/å–¶æ¥­ï¼‰</th><td id="pAllow">â€”</td></tr>
          <tr><th>ãƒ¡ãƒ¢</th><td id="pMemo">â€”</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <script>
    const RATE = 0.003; // 0.3%
    const LS_KEY = "ofa_monthly_report_v1";

    const PREFS = [
      "åŒ—æµ·é“","é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ",
      "èŒ¨åŸçœŒ","æ ƒæœ¨çœŒ","ç¾¤é¦¬çœŒ","åŸ¼ç‰çœŒ","åƒè‘‰çœŒ","æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ",
      "æ–°æ½ŸçœŒ","å¯Œå±±çœŒ","çŸ³å·çœŒ","ç¦äº•çœŒ","å±±æ¢¨çœŒ","é•·é‡çœŒ",
      "å²é˜œçœŒ","é™å²¡çœŒ","æ„›çŸ¥çœŒ","ä¸‰é‡çœŒ",
      "æ»‹è³€çœŒ","äº¬éƒ½åºœ","å¤§é˜ªåºœ","å…µåº«çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ",
      "é³¥å–çœŒ","å³¶æ ¹çœŒ","å²¡å±±çœŒ","åºƒå³¶çœŒ","å±±å£çœŒ",
      "å¾³å³¶çœŒ","é¦™å·çœŒ","æ„›åª›çœŒ","é«˜çŸ¥çœŒ",
      "ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ","æ²–ç¸„çœŒ",
      "ã‚¨ãƒªã‚¢å¤–","æœ¬éƒ¨å–¶æ¥­"
    ];

    const el = (id)=>document.getElementById(id);
    const month = el("month");
    const role = el("role");
    const reporter = el("reporter");
    const salesOwner = el("salesOwner");
    const pref = el("pref");
    const base = el("base");
    const memoShort = el("memoShort");

    const revenue = el("revenue");
    const outsource = el("outsource");
    const otherCost = el("otherCost");
    const outsourceMemo = el("outsourceMemo");
    const memoLong = el("memoLong");

    const yen = n => (Number(n)||0).toLocaleString("ja-JP");
    const toNum = v => {
      const s = String(v ?? "").replace(/[^\d.-]/g,"");
      const n = Number(s);
      return Number.isFinite(n) ? n : 0;
    };
    const pct = v => (v*100).toFixed(1) + "%";
    const nowMonth = ()=>{
      const d = new Date();
      const off = d.getTimezoneOffset();
      const local = new Date(d.getTime() - off*60000);
      return local.toISOString().slice(0,7);
    };

    function setPrefOptions(){
      pref.innerHTML = "";
      PREFS.forEach(p=>{
        const op = document.createElement("option");
        op.value = p;
        op.textContent = p;
        pref.appendChild(op);
      });
    }

    function recalc(){
      const rev = toNum(revenue.value);
      const out = toNum(outsource.value);
      const oth = toNum(otherCost.value);

      const cost = out + oth;
      const prof = rev - cost;
      const pr = rev ? (prof / rev) : 0;
      const or = rev ? (out / rev) : 0;

      el("costSum").textContent = yen(cost);
      el("profitSum").textContent = yen(prof);
      el("profitSum").className = prof>=0 ? "good" : "bad";
      el("profitRate").textContent = pct(pr);
      el("outRate").textContent = pct(or);

      const am = Math.floor(rev * RATE);
      const as = Math.floor(rev * RATE);
      el("allowMgr").textContent = yen(am);
      el("allowSales").textContent = yen(as);
      el("allowAll").textContent = yen(am+as);

      el("pMonth").textContent = month.value || "â€”";
      el("pWho").textContent = `${role.value} / ${reporter.value || "â€”"}`;
      el("pSales").textContent = salesOwner.value || "â€”";
      el("pArea").textContent = `${pref.value || "â€”"} / ${base.value || "â€”"}`;
      el("pMoney").textContent = `å£²ä¸Š ${yen(rev)}å†† / ã‚³ã‚¹ãƒˆ ${yen(cost)}å†† / åˆ©ç›Š ${yen(prof)}å††`;
      el("pRates").textContent = `åˆ©ç›Šç‡ ${pct(pr)} / å¤–æ³¨ç‡ ${pct(or)}`;
      el("pAllow").textContent = `ã‚¨ãƒªã‚¢ãƒãƒ ${yen(am)}å†† / å–¶æ¥­ ${yen(as)}å†† / åˆè¨ˆ ${yen(am+as)}å††`;

      const memoAll = [
        memoShort.value ? `çŸ­æ–‡ï¼š${memoShort.value}` : "",
        outsourceMemo.value ? `å§”è¨—å†…è¨³ï¼š${outsourceMemo.value}` : "",
        memoLong.value ? `è©³ç´°ï¼š${memoLong.value}` : ""
      ].filter(Boolean).join("\n");
      el("pMemo").textContent = memoAll || "â€”";
    }

    [month,role,reporter,salesOwner,pref,base,memoShort,revenue,outsource,otherCost,outsourceMemo,memoLong]
      .forEach(x=>x.addEventListener("input", recalc));

    [revenue,outsource,otherCost].forEach(inp=>{
      inp.addEventListener("blur", ()=>{
        const n = toNum(inp.value);
        inp.value = n ? n.toLocaleString("ja-JP") : "";
        recalc();
      });
    });

    function collect(){
      const rev = toNum(revenue.value);
      const out = toNum(outsource.value);
      const oth = toNum(otherCost.value);
      const cost = out + oth;
      const prof = rev - cost;
      const pr = rev ? prof/rev : 0;
      const or = rev ? out/rev : 0;

      return {
        month: month.value || "",
        role: role.value || "",
        reporter: reporter.value || "",
        salesOwner: salesOwner.value || "",
        pref: pref.value || "",
        base: base.value || "",
        memoShort: memoShort.value || "",
        revenue: rev,
        outsource: out,
        otherCost: oth,
        profit: prof,
        profitRate: pr,
        outsourceRate: or,
        allowMgr: Math.floor(rev*RATE),
        allowSales: Math.floor(rev*RATE),
        outsourceMemo: outsourceMemo.value || "",
        memoLong: memoLong.value || "",
        exportedAt: new Date().toISOString()
      };
    }

    function saveLocal(){
      const data = collect();
      localStorage.setItem(LS_KEY, JSON.stringify(data));
      alert("ç«¯æœ«ã«ä¿å­˜ã—ã¾ã—ãŸ");
    }

    function loadLocal(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const d = JSON.parse(raw);
        month.value = d.month || nowMonth();
        role.value = d.role || "ã‚¨ãƒªã‚¢ãƒãƒ";
        reporter.value = d.reporter || "";
        salesOwner.value = d.salesOwner || "";
        pref.value = d.pref || "é¹¿å…å³¶çœŒ";
        base.value = d.base || "";
        memoShort.value = d.memoShort || "";
        revenue.value = d.revenue ? Number(d.revenue).toLocaleString("ja-JP") : "";
        outsource.value = d.outsource ? Number(d.outsource).toLocaleString("ja-JP") : "";
        otherCost.value = d.otherCost ? Number(d.otherCost).toLocaleString("ja-JP") : "";
        outsourceMemo.value = d.outsourceMemo || "";
        memoLong.value = d.memoLong || "";
      }catch(e){}
    }

    function csvEscape(v){
      const s = String(v ?? "");
      if(/[",\n]/.test(s)) return `"${s.replace(/"/g,'""')}"`;
      return s;
    }

    function downloadText(text, filename, mime){
      const blob = new Blob([text], {type:mime});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function exportCSV(){
      const d = collect();
      const header = [
        "month","role","reporter","salesOwner","pref","base",
        "revenue","outsource","otherCost","cost","profit",
        "profitRate","outsourceRate",
        "allowMgr","allowSales",
        "memoShort","outsourceMemo","memoLong","exportedAt"
      ];
      const cost = d.outsource + d.otherCost;
      const row = [
        d.month,d.role,d.reporter,d.salesOwner,d.pref,d.base,
        d.revenue,d.outsource,d.otherCost,cost,d.profit,
        d.profitRate,d.outsourceRate,
        d.allowMgr,d.allowSales,
        d.memoShort,d.outsourceMemo,d.memoLong,d.exportedAt
      ].map(csvEscape);
      const csv = header.join(",") + "\n" + row.join(",");
      const fn = `OFA_æœˆæ¬¡å ±å‘Š_${d.month || "æœªè¨­å®š"}_${d.pref || "æœªè¨­å®š"}_${d.base || "æ‹ ç‚¹"}.csv`;
      downloadText(csv, fn, "text/csv");
    }

    function exportPDF(){
      recalc();
      window.print();
    }

    function clearAll(){
      if(!confirm("å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")) return;
      month.value = nowMonth();
      role.value = "ã‚¨ãƒªã‚¢ãƒãƒ";
      reporter.value = "";
      salesOwner.value = "";
      pref.value = "é¹¿å…å³¶çœŒ";
      base.value = "";
      memoShort.value = "";
      revenue.value = "";
      outsource.value = "";
      otherCost.value = "";
      outsourceMemo.value = "";
      memoLong.value = "";
      recalc();
    }

    // ===== LPãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•å…¥åŠ›ï¼ˆæ‹ ç‚¹LPå¯¾å¿œï¼‰=====
    function applyParams(){
      const qs = new URLSearchParams(location.search);
      const pPref = qs.get("pref");
      const pBase = qs.get("base");
      const pSales = qs.get("sales");
      const pRole = qs.get("role");
      const pReporter = qs.get("reporter");
      const pMonth = qs.get("month");

      if (pMonth) month.value = pMonth;
      if (pPref) pref.value = pPref;
      if (pBase) base.value = pBase;
      if (pSales) salesOwner.value = pSales;
      if (pRole) role.value = pRole;
      if (pReporter) reporter.value = pReporter;

      recalc();
    }

    // init
    setPrefOptions();
    month.value = nowMonth();
    pref.value = "é¹¿å…å³¶çœŒ";
    loadLocal();
    applyParams();
    recalc();

    // actions
    el("btnPDF").addEventListener("click", exportPDF);
    el("btnCSV").addEventListener("click", exportCSV);
    el("btnSave").addEventListener("click", saveLocal);
    el("btnClear").addEventListener("click", clearAll);
  </script>
</body>
</html>
