<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OFA拠点売上 月次管理</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans JP",sans-serif;
  background:#fff;
  color:#111;
  margin:0;
}
.wrap{
  max-width:1200px;
  margin:auto;
  padding:16px 14px 120px;
}
h1{
  margin:0 0 10px;
  font-size:20px;
  font-weight:900;
}
.card{
  border:2px solid #000;
  border-radius:12px;
  padding:14px;
  margin-bottom:14px;
}
label{
  font-size:12px;
  font-weight:900;
}
input{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}
button{
  padding:10px 14px;
  border-radius:10px;
  border:2px solid #000;
  font-weight:900;
  cursor:pointer;
}
.yellow{background:#FFD400}
.blue{background:#0066CC;color:#fff}
.red{background:#E60012;color:#fff}
.green{background:#0FA958;color:#fff}
.gray{background:#eee}

.row{display:grid;gap:10px}
@media(min-width:900px){
  .cols4{grid-template-columns:1fr 1fr 1fr 1fr}
  .cols3{grid-template-columns:1fr 1fr 1fr}
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  font-size:13px;
  text-align:right;
}
th{
  background:#f2f2f2;
  text-align:center;
  font-weight:900;
}
.left{text-align:left}
</style>
</head>

<body>
<div class="wrap">

<h1>OFA拠点売上 月次管理</h1>

<div class="card">
  <div class="row cols4">
    <div>
      <label>対象月</label>
      <input type="month" id="month">
    </div>
    <div>
      <label>都道府県</label>
      <input id="pref">
    </div>
    <div>
      <label>拠点名</label>
      <input id="base">
    </div>
    <div>
      <label>責任者</label>
      <input id="manager">
    </div>
  </div>
</div>

<div class="card">
  <h3>売上・下払い</h3>
  <div class="row cols3">
    <div>
      <label>売上合計</label>
      <input id="sales">
    </div>
    <div>
      <label>下払い（ドライバー）</label>
      <input id="payout">
    </div>
    <div>
      <label>粗利</label>
      <input id="gross" readonly>
    </div>
  </div>
</div>

<div class="card">
  <h3>委託業者（複数入力）</h3>
  <table id="vendorTable">
    <thead>
      <tr>
        <th class="left">委託業者名</th>
        <th>支払い額</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button class="yellow" onclick="addVendor()">＋ 委託業者を追加</button>
</div>

<div class="card">
  <h3>集計（自動）</h3>
  <table>
    <tr style="background:#FFF7CC">
      <th>売上</th>
      <td id="tSales">0</td>
    </tr>
    <tr style="background:#E8F1FF">
      <th>下払い</th>
      <td id="tPayout">0</td>
    </tr>
    <tr style="background:#FFECEC">
      <th>委託支払合計</th>
      <td id="tVendor">0</td>
    </tr>
    <tr style="background:#E9F7EF">
      <th>利益</th>
      <td id="tProfit">0</td>
    </tr>
    <tr style="background:#DFF5E3">
      <th>最終利益</th>
      <td id="tFinal">0</td>
    </tr>
  </table>
</div>

<div style="display:flex;gap:10px;flex-wrap:wrap">
  <button class="blue" onclick="window.print()">PDF出力</button>
  <button class="green" onclick="exportCSV()">CSV出力</button>
</div>

</div>

<script>
function yen(n){
  return (Number(n)||0).toLocaleString("ja-JP");
}

function recalc(){
  const sales=+document.getElementById("sales").value||0;
  const payout=+document.getElementById("payout").value||0;
  const gross=sales-payout;
  document.getElementById("gross").value=yen(gross);

  let vendorSum=0;
  document.querySelectorAll(".vendorAmount").forEach(i=>{
    vendorSum+=+i.value||0;
  });

  const profit=gross-vendorSum;

  document.getElementById("tSales").textContent=yen(sales);
  document.getElementById("tPayout").textContent=yen(payout);
  document.getElementById("tVendor").textContent=yen(vendorSum);
  document.getElementById("tProfit").textContent=yen(profit);
  document.getElementById("tFinal").textContent=yen(profit);
}

function addVendor(){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td class="left"><input></td>
    <td><input class="vendorAmount"></td>
    <td><button class="red" onclick="this.closest('tr').remove();recalc()">×</button></td>
  `;
  document.querySelector("#vendorTable tbody").appendChild(tr);
  tr.querySelector(".vendorAmount").addEventListener("input",recalc);
}

document.querySelectorAll("input").forEach(i=>{
  i.addEventListener("input",recalc);
});

function exportCSV(){
  let csv=`月,都道府県,拠点,責任者,売上,下払い,委託合計,最終利益\n`;
  csv+=`${month.value},${pref.value},${base.value},${manager.value},${sales.value},${payout.value},${tVendor.textContent.replace(/,/g,"")},${tFinal.textContent.replace(/,/g,"")}`;
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="ofa_拠点売上.csv";
  a.click();
}
</script>

</body>
</html>
